# This is a *phony* makefile that delegates the building process to other Makefiles
# This makefile has higher privilege than a regular Makefile, since GNUmakefile>makefile>Makefile
# Thus it will filter out the default Makefile generated by autotools
# Do remove this file if you are using the in-source build

build_root=../..

# 32-bit versions
dir_gcc32="$(build_root)/buildgcc32/src/kernel"
dir_icc32="$(build_root)/buildicc32/src/kernel"
dir_mpi32="$(build_root)/buildgcc32mpi/src/kernel"
dir_dbl32="$(build_root)/buildgcc32dbl/src/kernel"

# 64-bit versions
dir_gcc="$(build_root)/buildgcc/src/kernel"
dir_icc="$(build_root)/buildicc/src/kernel"
dir_mpi="$(build_root)/buildgccmpi/src/kernel"
dir_dbl="$(build_root)/buildgccdbl/src/kernel"

# default gcc build
gcc32:
	./updmd.py -a
	$(MAKE) -C $(dir_gcc32)

# -C changes the current directory before running $(MAKE)

# icc build
icc32:
	./updmd.py -a
	$(MAKE) -C $(dir_icc32)

# mpi build
mpi32:
	./updmd.py -a
	$(MAKE) -C $(dir_mpi32)

# dbl build
dbl32:
	./updmd.py -a
	$(MAKE) -C $(dir_dbl32)

# 64-bit version

# gcc build
gcc:
	./updmd.py -a
	$(MAKE) -C $(dir_gcc)

# icc build
icc:
	./updmd.py -a
	$(MAKE) -C $(dir_icc)

# mpi build
mpi:
	./updmd.py -a
	$(MAKE) -C $(dir_mpi)

# dbl build
dbl:
	./updmd.py -a
	$(MAKE) -C $(dir_dbl)


all:
	./updmd.py -a
	$(MAKE) -C $(dir_gcc32)
	$(MAKE) -C $(dir_icc32)
	$(MAKE) -C $(dir_mpi32)
	$(MAKE) -C $(dir_dbl32)

md1:
	./updmd.py -a
	$(MAKE) -C $(dir_def) md1

md2:
	./updmd.py -a
	$(MAKE) -C $(dir_def) md2

.PHONY: clean gcc icc mpi dbl gcc32 icc32 mpi32 dbl32 all

clean:
	rm -f *~ *.bak* tmp* md[1-2]a.c mdfoo*.c

